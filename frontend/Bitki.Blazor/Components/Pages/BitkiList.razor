@page "/bitki"
@using Bitki.Blazor.Models
@inject HttpClient Http

<h1>Bitkiler</h1>

@if (bitkiler == null)
{
    if (isLoading)
    {
        <div class="loading-indicator">
            <div class="spinner-border spinner-border-sm text-secondary" role="status"></div>
            Veriler yükleniyor...
        </div>
    }
    else
    {
        <p class="text-danger">@errorMessage</p>
    }
}
else
{
    <div class="record-count">Kayıt Sayısı: @bitkiler.Count</div>

    <div class="table-responsive">
        <table class="table academic-table">
            <thead>
                <tr>
                    <th>Ad</th>
                    <th>Latince Ad</th>
                    <th>Aile</th>
                    <th>Açıklama</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var bitki in bitkiler)
                {
                    <tr>
                        <td class="fw-bold text-primary">@bitki.Name</td>
                        <td class="fst-italic">@bitki.LatinName</td>
                        <td>@bitki.Family</td>
                        <td class="text-muted small">@bitki.Description</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}

@code {
    private List<BitkiViewModel>? bitkiler;
    private bool isLoading = true;
    private string errorMessage = "No data returned";

    protected override async Task OnInitializedAsync()
    {
        try
        {
            bitkiler = await Http.GetFromJsonAsync<List<BitkiViewModel>>("api/bitki");
            isLoading = false;
        }
        catch (Exception ex)
        {
            isLoading = false;
            errorMessage = $"Error fetching data: {ex.Message}";
            Console.WriteLine(ex);
        }
    }
}